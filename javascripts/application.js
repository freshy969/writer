!function(){window.Elements=function(){function t(){}return t.canvas=document.querySelector(".canvas"),t.new_char=function(t){var e;return e=document.createElement("div"),e.className="character",e.innerHTML=t,e},t.new_break=function(){var t;return t=document.createElement("br"),t.className="newline",t},t}.call(this)}.call(this),function(){window.Helpers=function(){function t(){}return t.wordwrap=function(t){var e,s,i,r,n,o,h,a,c;for(e=0,n=Math.floor((t.offsetWidth-110)/10),c=[],i=h=0,a=t.children.length;a>=0?a>h:h>a;i=a>=0?++h:--h)s=t.children[i],"character"===s.className&&(e+=1),s.classList.contains("enter")&&(e=0),"newline"===s.className&&(t.insertBefore(Elements.new_char("&nbsp;"),s),t.removeChild(s)),e>n?c.push(function(){var s,n;for(n=[],r=s=i;s>=0;r=s+=-1){if(o=t.children[r],"&nbsp;"===o.innerHTML){t.insertBefore(Elements.new_break(),o),t.removeChild(o),e=0;break}n.push(void 0)}return n}()):c.push(void 0);return c},t.ensure_visible=function(t,e){var s,i,r;for(s=e.get_coords(),i=50;!(s[1]>=t.scrollTop+i);)t.scrollTop-=10,s=e.get_coords();for(r=[];!(s[1]-t.scrollTop<=window.innerHeight-i);)t.scrollTop+=10,r.push(s=e.get_coords());return r},t.get_char_height=function(t){var e,s;return e=document.createElement("div"),e.className="character",e.innerHTML="&nbsp;",t.appendChild(e),s=e.offsetHeight,t.removeChild(e),s},t.get_left_count=function(t,e){var s,i;for(s=0,i=t.children[e-s];i&&!i.classList.contains("newline");)s+=1,i=t.children[e-s];return s-1},t.get_caret_pos=function(t,e){var s;return s=Array.prototype.slice.call(t.children),s.indexOf(e)},t}.call(this)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.Canvas=function(){function e(e){this.el=e,this.resize_listener=t(this.resize_listener,this),this.paste_listener=t(this.paste_listener,this),this.blur_listener=t(this.blur_listener,this),this.focus_listener=t(this.focus_listener,this),this.keyup_listener=t(this.keyup_listener,this),this.keydown_listener=t(this.keydown_listener,this),this.keypress_listener=t(this.keypress_listener,this),this.el.className=""+this.base_class+" focus",this.el.onpaste=this.paste_listener,this.caret=new Caret(this.el),this.keys={},window.onkeypress=this.keypress_listener,window.onkeydown=this.keydown_listener,window.onkeyup=this.keyup_listener,window.onfocus=this.focus_listener,window.onblur=this.blur_listener,window.onresize=this.resize_listener}return e.prototype.base_class="canvas transition",e.prototype.keypress_listener=function(t){var e;return 13!==t.which&&32!==t.which?(e=String.fromCharCode(t.which),this.caret.type(e),window.getSelection().collapse(),Helpers.ensure_visible(this.el,this.caret)):void 0},e.prototype.keydown_listener=function(t){var e,s,i;switch(this.keys[t.which]=!0,s=this.keys[91]||this.keys[93]||this.keys[224]||this.keys[17]?!0:!1,e=this.keys[18]?!0:!1,i=!1,t.which){case 8:this.caret["delete"](t),i=!0;break;case 9:this.caret.tab(t),i=!0;break;case 13:this.caret.enter(),i=!0;break;case 32:this.caret.spacebar(t),i=!0;break;case 37:s?this.caret.move_cmd_left(t):e?this.caret.move_alt_left(t):this.caret.move_left(t),i=!0;break;case 38:s?this.caret.move_cmd_up(t):this.caret.move_up(t),i=!0;break;case 39:s?this.caret.move_cmd_right(t):e?this.caret.move_alt_right(t):this.caret.move_right(t),i=!0;break;case 40:s?this.caret.move_cmd_down(t):this.caret.move_down(t),i=!0}return i===!0?(window.getSelection().collapse(),Helpers.ensure_visible(this.el,this.caret)):void 0},e.prototype.keyup_listener=function(t){return this.keys[t.which]=!1},e.prototype.focus_listener=function(){return this.el.className=""+this.base_class+" focus"},e.prototype.blur_listener=function(){return this.el.className=this.base_class},e.prototype.paste_listener=function(t){var e,s,i,r,n;for(s=t.clipboardData.getData("text/plain"),n=[],e=i=0,r=s.length;r>=0?r>i:i>r;e=r>=0?++i:--i)" "===s[e]?n.push(this.caret.spacebar()):"\n"===s[e]?n.push(this.caret.enter()):n.push(this.caret.type(s[e]));return n},e.prototype.resize_listener=function(){return Helpers.wordwrap(this.el),this.caret.set_pos(Helpers.get_caret_pos(this.el,this.caret.el))},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};window.Caret=function(){function e(e){this.canvas=e,this.set_pos=t(this.set_pos,this),this.get_coords=t(this.get_coords,this),this.error=t(this.error,this),this.move_cmd_up=t(this.move_cmd_up,this),this.move_up=t(this.move_up,this),this.move_cmd_down=t(this.move_cmd_down,this),this.move_down=t(this.move_down,this),this.move_alt_right=t(this.move_alt_right,this),this.move_cmd_right=t(this.move_cmd_right,this),this.move_right=t(this.move_right,this),this.move_alt_left=t(this.move_alt_left,this),this.move_cmd_left=t(this.move_cmd_left,this),this.move_left=t(this.move_left,this),this["delete"]=t(this["delete"],this),this.enter=t(this.enter,this),this.spacebar=t(this.spacebar,this),this.tab=t(this.tab,this),this.type=t(this.type,this),this.el=document.createElement("div"),this.el.className="caret",this.el.style.height=Helpers.get_char_height(this.canvas)+"px",this.canvas.appendChild(this.el)}return e.prototype.pos=0,e.prototype.tab_size=4,e.prototype.type=function(t){var e,s=this;return e=Elements.new_char(t),this.canvas.insertBefore(e,this.el),this.pos+=1,e.onclick=function(){return s.canvas.insertBefore(s.el,e),s.pos=Helpers.get_caret_pos(s.canvas,s.el)},this.canvas.scrollWidth>this.canvas.clientWidth?(Helpers.wordwrap(this.canvas),this.pos=Helpers.get_caret_pos(this.canvas,this.el)):void 0},e.prototype.tab=function(t){var e,s,i;for(t.preventDefault(),i=[],e=0,s=this.tab_size;s>=0?s>e:e>s;s>=0?e++:e--)i.push(this.spacebar());return i},e.prototype.spacebar=function(t){return t&&t.preventDefault(),this.type("&nbsp;")},e.prototype.enter=function(){var t;return this.pos+=1,t=Elements.new_break(),t.classList.add("enter"),this.canvas.insertBefore(t,this.el)},e.prototype["delete"]=function(t){var e,s,i,r,n,o,h,a,c;if(t.preventDefault(),h=window.getSelection(),0===h.toString().length)return e=this.canvas.children[this.pos-1],e?(this.pos-=1,this.canvas.removeChild(e),!0):this.error();for(r=h.getRangeAt(0),n=r.startContainer.parentNode,o=r.endContainer.parentNode,o!==this.canvas&&(this.canvas.insertBefore(this.el,o),this.pos=Helpers.get_caret_pos(this.canvas,this.el),this.move_right()),s=Array.prototype.slice.call(this.canvas.children),i=s.indexOf(n),a=this.pos-i,e=this.canvas.children[this.pos-1],c=0;a>=0?a>c:c>a;a>=0?c++:c--)this.pos-=1,this.canvas.removeChild(e),e=this.canvas.children[this.pos-1];return h.collapse(),!0},e.prototype.move_left=function(t){var e;return t&&t.preventDefault(),this.pos>0?(e=this.canvas.children[this.pos-1],this.pos-=1,this.canvas.insertBefore(this.el,e),!0):this.error()},e.prototype.move_cmd_left=function(t){var e,s;for(t.preventDefault(),e=Helpers.get_left_count(this.canvas,this.pos),s=0;e>=0?e>s:s>e;e>=0?s++:s--)this.move_left();return this.el.className="caret"},e.prototype.move_alt_left=function(t){var e,s;if(t.preventDefault(),e=this.canvas.children[this.pos-1]){for(;"&nbsp;"===e.innerHTML||e.classList.contains("newline");)this.move_left(),e=this.canvas.children[this.pos-1];for(s=[];e&&"&nbsp;"!==e.innerHTML&&!e.classList.contains("newline");)this.move_left(),s.push(e=this.canvas.children[this.pos-1]);return s}},e.prototype.move_right=function(t){var e,s;return t&&t.preventDefault(),this.pos<=this.canvas.children.length-2?(e=this.pos===this.canvas.children.length-2,s=this.canvas.children[this.pos+2],this.pos+=1,e?this.canvas.appendChild(this.el):this.canvas.insertBefore(this.el,s),!0):this.error()},e.prototype.move_cmd_right=function(t){var e;for(t.preventDefault();;)if(e=this.canvas.children[this.pos+1],e&&"newline"===e.className||!this.move_right())break;return this.el.className="caret"},e.prototype.move_alt_right=function(t){var e,s;if(t.preventDefault(),e=this.canvas.children[this.pos+1]){for(;"&nbsp;"===e.innerHTML||e.classList.contains("newline");)this.move_right(),e=this.canvas.children[this.pos+1];for(s=[];e&&"&nbsp;"!==e.innerHTML&&!e.classList.contains("newline");)this.move_right(),s.push(e=this.canvas.children[this.pos+1]);return s}},e.prototype.move_down=function(t){var e,s,i;if(t&&t.preventDefault(),!this.canvas.children[this.pos+1])return this.error();for(e=Helpers.get_left_count(this.canvas,this.pos);this.move_right()&&0!==Helpers.get_left_count(this.canvas,this.pos););for(i=0;e>=0?e>i:i>e;e>=0?i++:i--)s=this.canvas.children[this.pos+1],s&&s.classList.contains("newline")||this.move_right();return this.el.className="caret"},e.prototype.move_cmd_down=function(t){return t.preventDefault(),this.canvas.appendChild(this.el),this.pos=this.canvas.children.length-1},e.prototype.move_up=function(t){var e,s,i,r;if(t&&t.preventDefault(),!this.canvas.children[this.pos-1])return this.error();if(e=Helpers.get_left_count(this.canvas,this.pos),e>0)for(;this.move_left()&&0!==Helpers.get_left_count(this.canvas,this.pos););if(this.move_left(),s=Helpers.get_left_count(this.canvas,this.pos),i=s-e,i>0)for(r=0;i>=0?i>r:r>i;i>=0?r++:r--)this.move_left();return this.el.className="caret"},e.prototype.move_cmd_up=function(t){var e,s;if(t.preventDefault(),this.canvas.children.length>1){for(s=0,e=this.canvas.children[s];e.classList.contains("caret");)s+=1,e=this.canvas.children[s];return this.pos=0,this.canvas.insertBefore(this.el,e)}},e.prototype.error=function(){var t;return this.el.className="caret error",t=this.el,setTimeout(function(){return t.className="caret"},500),!1},e.prototype.get_coords=function(){return[this.el.offsetLeft,this.el.offsetTop]},e.prototype.set_pos=function(t){this.pos=t},e}()}.call(this),function(){new Canvas(Elements.canvas)}.call(this),function(){}.call(this);