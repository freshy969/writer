!function(){window.Elements=function(){function e(){}return e.canvas=document.querySelector(".canvas"),e.new_char=function(e){var t;return t=document.createElement("div"),t.className="character",t.innerHTML=e,t},e.new_break=function(){var e;return e=document.createElement("br"),e.className="newline",e},e}.call(this)}.call(this),function(){window.Helpers=function(){function e(){}return e.wordwrap=function(e){var t,s,i,r,n,o,h,a,c;for(t=0,n=Math.floor((e.offsetWidth-110)/10),c=[],i=h=0,a=e.children.length;a>=0?a>h:h>a;i=a>=0?++h:--h)s=e.children[i],"character"===s.className&&(t+=1),s.classList.contains("enter")&&(t=0),"newline"===s.className&&(e.insertBefore(Elements.new_char("&nbsp;"),s),e.removeChild(s)),t>n?c.push(function(){var s,n;for(n=[],r=s=i;s>=0;r=s+=-1){if(o=e.children[r],"&nbsp;"===o.innerHTML){e.insertBefore(Elements.new_break(),o),e.removeChild(o),t=0;break}n.push(void 0)}return n}()):c.push(void 0);return c},e.ensure_visible=function(e,t){var s,i,r;for(s=t.get_coords(),i=50;!(s[1]>=e.scrollTop+i);)e.scrollTop-=10,s=t.get_coords();for(r=[];!(s[1]-e.scrollTop<=window.innerHeight-i);)e.scrollTop+=10,r.push(s=t.get_coords());return r},e.get_char_height=function(e){var t,s;return t=document.createElement("div"),t.className="character",t.innerHTML="&nbsp;",e.appendChild(t),s=t.offsetHeight,e.removeChild(t),s},e.get_left_count=function(e,t){var s,i;for(s=0,i=e.children[t-s];i&&"newline"!==i.className;)s+=1,i=e.children[t-s];return s-1},e.get_caret_pos=function(e,t){var s;return s=Array.prototype.slice.call(e.children),s.indexOf(t)},e}.call(this)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};window.Canvas=function(){function t(t){this.el=t,this.resize_listener=e(this.resize_listener,this),this.paste_listener=e(this.paste_listener,this),this.blur_listener=e(this.blur_listener,this),this.focus_listener=e(this.focus_listener,this),this.keyup_listener=e(this.keyup_listener,this),this.keydown_listener=e(this.keydown_listener,this),this.keypress_listener=e(this.keypress_listener,this),this.el.className=""+this.base_class+" focus",this.el.onpaste=this.paste_listener,this.caret=new Caret(this.el),this.keys={},window.onkeypress=this.keypress_listener,window.onkeydown=this.keydown_listener,window.onkeyup=this.keyup_listener,window.onfocus=this.focus_listener,window.onblur=this.blur_listener,window.onresize=this.resize_listener}return t.prototype.base_class="canvas transition",t.prototype.keypress_listener=function(e){var t;return 13!==e.which&&32!==e.which?(t=String.fromCharCode(e.which),this.caret.type(t),window.getSelection().collapse(),Helpers.ensure_visible(this.el,this.caret)):void 0},t.prototype.keydown_listener=function(e){var t,s,i;switch(this.keys[e.which]=!0,s=this.keys[91]||this.keys[93]||this.keys[224]||this.keys[17]?!0:!1,t=this.keys[18]?!0:!1,i=!1,e.which){case 8:this.caret["delete"](e),i=!0;break;case 9:this.caret.tab(e),i=!0;break;case 13:this.caret.enter(),i=!0;break;case 32:this.caret.spacebar(e),i=!0;break;case 37:s?this.caret.move_cmd_left(e):t?this.caret.move_alt_left(e):this.caret.move_left(e),i=!0;break;case 38:s?this.caret.move_cmd_up(e):this.caret.move_up(e),i=!0;break;case 39:s?this.caret.move_cmd_right(e):t?this.caret.move_alt_right(e):this.caret.move_right(e),i=!0;break;case 40:s?this.caret.move_cmd_down(e):this.caret.move_down(e),i=!0}return i===!0?(window.getSelection().collapse(),Helpers.ensure_visible(this.el,this.caret)):void 0},t.prototype.keyup_listener=function(e){return this.keys[e.which]=!1},t.prototype.focus_listener=function(){return this.el.className=""+this.base_class+" focus"},t.prototype.blur_listener=function(){return this.el.className=this.base_class},t.prototype.paste_listener=function(e){var t,s,i,r,n;for(s=e.clipboardData.getData("text/plain"),n=[],t=i=0,r=s.length;r>=0?r>i:i>r;t=r>=0?++i:--i)" "===s[t]?n.push(this.caret.spacebar()):"\n"===s[t]?n.push(this.caret.enter()):n.push(this.caret.type(s[t]));return n},t.prototype.resize_listener=function(){return Helpers.wordwrap(this.el),this.caret.set_pos(Helpers.get_caret_pos(this.el,this.caret.el))},t}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};window.Caret=function(){function t(t){this.canvas=t,this.set_pos=e(this.set_pos,this),this.get_coords=e(this.get_coords,this),this.error=e(this.error,this),this.move_cmd_up=e(this.move_cmd_up,this),this.move_up=e(this.move_up,this),this.move_cmd_down=e(this.move_cmd_down,this),this.move_down=e(this.move_down,this),this.move_alt_right=e(this.move_alt_right,this),this.move_cmd_right=e(this.move_cmd_right,this),this.move_right=e(this.move_right,this),this.move_alt_left=e(this.move_alt_left,this),this.move_cmd_left=e(this.move_cmd_left,this),this.move_left=e(this.move_left,this),this["delete"]=e(this["delete"],this),this.enter=e(this.enter,this),this.spacebar=e(this.spacebar,this),this.tab=e(this.tab,this),this.type=e(this.type,this),this.el=document.createElement("div"),this.el.className="caret",this.el.style.height=Helpers.get_char_height(this.canvas)+"px",this.canvas.appendChild(this.el)}return t.prototype.pos=0,t.prototype.tab_size=4,t.prototype.type=function(e){var t,s=this;return t=Elements.new_char(e),this.canvas.insertBefore(t,this.el),this.pos+=1,t.onclick=function(){return s.canvas.insertBefore(s.el,t),s.pos=Helpers.get_caret_pos(s.canvas,s.el)},this.canvas.scrollWidth>this.canvas.clientWidth?(Helpers.wordwrap(this.canvas),this.pos=Helpers.get_caret_pos(this.canvas,this.el)):void 0},t.prototype.tab=function(e){var t,s,i;for(e.preventDefault(),i=[],t=0,s=this.tab_size;s>=0?s>t:t>s;s>=0?t++:t--)i.push(this.spacebar());return i},t.prototype.spacebar=function(e){return e&&e.preventDefault(),this.type("&nbsp;")},t.prototype.enter=function(){var e;return this.pos+=1,e=Elements.new_break(),e.classList.add("enter"),this.canvas.insertBefore(e,this.el)},t.prototype["delete"]=function(e){var t,s,i,r,n,o,h,a,c;if(e.preventDefault(),h=window.getSelection(),0===h.toString().length)return t=this.canvas.children[this.pos-1],t?(this.pos-=1,this.canvas.removeChild(t),!0):this.error();for(r=h.getRangeAt(0),n=r.startContainer.parentNode,o=r.endContainer.parentNode,o!==this.canvas&&(this.canvas.insertBefore(this.el,o),this.pos=Helpers.get_caret_pos(this.canvas,this.el),this.move_right()),s=Array.prototype.slice.call(this.canvas.children),i=s.indexOf(n),a=this.pos-i,t=this.canvas.children[this.pos-1],c=0;a>=0?a>c:c>a;a>=0?c++:c--)this.pos-=1,this.canvas.removeChild(t),t=this.canvas.children[this.pos-1];return h.collapse(),!0},t.prototype.move_left=function(e){var t;return e&&e.preventDefault(),this.pos>0?(t=this.canvas.children[this.pos-1],this.pos-=1,this.canvas.insertBefore(this.el,t),!0):this.error()},t.prototype.move_cmd_left=function(e){var t,s;for(e.preventDefault(),t=Helpers.get_left_count(this.canvas,this.pos),s=0;t>=0?t>s:s>t;t>=0?s++:s--)this.move_left();return this.el.className="caret"},t.prototype.move_alt_left=function(e){var t,s;if(e.preventDefault(),t=this.canvas.children[this.pos-1]){for(;"&nbsp;"===t.innerHTML||"newline"===t.className;)this.move_left(),t=this.canvas.children[this.pos-1];for(s=[];t&&"&nbsp;"!==t.innerHTML&&"newline"!==t.className;)this.move_left(),s.push(t=this.canvas.children[this.pos-1]);return s}},t.prototype.move_right=function(e){var t,s;return e&&e.preventDefault(),this.pos<=this.canvas.children.length-2?(t=this.pos===this.canvas.children.length-2,s=this.canvas.children[this.pos+2],this.pos+=1,t?this.canvas.appendChild(this.el):this.canvas.insertBefore(this.el,s),!0):this.error()},t.prototype.move_cmd_right=function(e){var t;for(e.preventDefault();;)if(t=this.canvas.children[this.pos+1],t&&"newline"===t.className||!this.move_right())break;return this.el.className="caret"},t.prototype.move_alt_right=function(e){var t,s;if(e.preventDefault(),t=this.canvas.children[this.pos+1]){for(;"&nbsp;"===t.innerHTML||"newline"===t.className;)this.move_right(),t=this.canvas.children[this.pos+1];for(s=[];t&&"&nbsp;"!==t.innerHTML&&"newline"!==t.className;)this.move_right(),s.push(t=this.canvas.children[this.pos+1]);return s}},t.prototype.move_down=function(e){var t,s,i;if(e&&e.preventDefault(),!this.canvas.children[this.pos+1])return this.error();for(t=Helpers.get_left_count(this.canvas,this.pos);this.move_right()&&0!==Helpers.get_left_count(this.canvas,this.pos););for(i=0;t>=0?t>i:i>t;t>=0?i++:i--)s=this.canvas.children[this.pos+1],s&&"newline"===s.className||this.move_right();return this.el.className="caret"},t.prototype.move_cmd_down=function(e){for(e.preventDefault();;)if(!this.move_right())break;return this.el.className="caret"},t.prototype.move_up=function(e){var t,s,i,r;if(e&&e.preventDefault(),!this.canvas.children[this.pos-1])return this.error();if(t=Helpers.get_left_count(this.canvas,this.pos),t>0)for(;this.move_left()&&0!==Helpers.get_left_count(this.canvas,this.pos););if(this.move_left(),s=Helpers.get_left_count(this.canvas,this.pos),i=s-t,i>0)for(r=0;i>=0?i>r:r>i;i>=0?r++:r--)this.move_left();return this.el.className="caret"},t.prototype.move_cmd_up=function(e){for(e.preventDefault();;)if(!this.move_left())break;return this.el.className="caret"},t.prototype.error=function(){var e;return this.el.className="caret error",e=this.el,setTimeout(function(){return e.className="caret"},500),!1},t.prototype.get_coords=function(){return[this.el.offsetLeft,this.el.offsetTop]},t.prototype.set_pos=function(e){this.pos=e},t}()}.call(this),function(){new Canvas(Elements.canvas)}.call(this),function(){}.call(this);