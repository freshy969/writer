(function(){var t,e,s,i=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t){this.el=t,this.blur_listener=i(this.blur_listener,this),this.focus_listener=i(this.focus_listener,this),this.cursor=new e(this.el),window.onkeydown=this.cursor.keydown_listener,window.onkeypress=this.cursor.keypress_listener,window.onfocus=this.focus_listener,window.onblur=this.blur_listener}return t.prototype.focus_listener=function(){return this.el.className="canvas focus"},t.prototype.blur_listener=function(){return this.el.className="canvas"},t}(),e=function(){function t(t){var e;this.canvas=t,this.keypress_listener=i(this.keypress_listener,this),this.keydown_listener=i(this.keydown_listener,this),this.error=i(this.error,this),this.get_cursor_pos=i(this.get_cursor_pos,this),this.get_col_els=i(this.get_col_els,this),this.move_up=i(this.move_up,this),this.move_down=i(this.move_down,this),this.move_right=i(this.move_right,this),this.move_left=i(this.move_left,this),this.enter=i(this.enter,this),this["delete"]=i(this["delete"],this),this.get_char_height=i(this.get_char_height,this),e=3,this.pos=0,this.el=document.createElement("div"),this.el.className="cursor",this.el.style.height=""+(this.get_char_height()+e)+"px",this.el.style.marginTop=""+e+"px",this.canvas.appendChild(this.el)}return t.prototype.get_char_height=function(){var t,e,s;return t=document.createElement("div"),t.className="character",t.innerHTML="&nbsp;",this.canvas.appendChild(t),e=document.defaultView.getComputedStyle(t,""),s=t.offsetHeight+parseInt(e.getPropertyValue("margin-top"))+parseInt(e.getPropertyValue("margin-bottom")),this.canvas.removeChild(t),s},t.prototype["delete"]=function(t){var e;return t.preventDefault(),e=this.canvas.children[this.pos-1],e?(this.pos-=1,this.canvas.removeChild(e)):this.error()},t.prototype.enter=function(){var t;return this.pos+=1,t=document.createElement("br"),t.className="newline",this.canvas.insertBefore(t,this.el)},t.prototype.move_left=function(){var t;return this.pos>0?(t=this.canvas.children[this.pos-1],this.pos-=1,this.canvas.insertBefore(this.el,t)):this.error()},t.prototype.move_right=function(){var t,e;return this.pos<=this.canvas.children.length-2?(t=this.pos===this.canvas.children.length-2,e=this.canvas.children[this.pos+2],this.pos+=1,t?this.canvas.appendChild(this.el):this.canvas.insertBefore(this.el,e)):this.error()},t.prototype.move_down=function(){var t,e;return e=this.get_col_els(),t=e.indexOf(this.el),e[t+1]?e[t+1].offsetTop===this.el.offsetTop-3?e[t+2]?this.canvas.insertBefore(this.el,e[t+2]):this.canvas.appendChild(this.el):this.canvas.insertBefore(this.el,e[t+1]):this.canvas.appendChild(this.el),this.pos=this.get_cursor_pos()},t.prototype.move_up=function(){var t,e;return e=this.get_col_els(),t=e.indexOf(this.el),e[t-1]?this.canvas.insertBefore(this.el,e[t-1]):this.canvas.children[0]&&this.canvas.insertBefore(this.el,this.canvas.children[0]),this.pos=this.get_cursor_pos()},t.prototype.get_col_els=function(){var t,e,s,i,r,n;for(t=[],e=this.el.offsetLeft,n=this.canvas.children,i=0,r=n.length;r>i;i++)s=n[i],s.offsetLeft===e&&t.push(s);return t},t.prototype.get_cursor_pos=function(){var t;return t=Array.prototype.slice.call(this.canvas.children),t.indexOf(this.el)},t.prototype.error=function(){var t;return this.el.className="cursor error",t=this.el,setTimeout(function(){return t.className="cursor"},500)},t.prototype.keydown_listener=function(t){switch(t.which){case 8:return this["delete"](t);case 37:return this.move_left();case 38:return this.move_up();case 39:return this.move_right();case 40:return this.move_down();case 13:return this.enter()}},t.prototype.keypress_listener=function(t){var e;return t.which!==13?(e=document.createElement("div"),e.className="character",e.innerHTML=String.fromCharCode(t.which),e.innerHTML===" "&&(e.innerHTML="&nbsp;"),this.canvas.insertBefore(e,this.el),this.pos+=1):void 0},t}(),s=document.querySelector(".canvas"),s=new t(s)}).call(this);